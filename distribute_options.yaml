# Fastforge Configuration
# Variables filled by GitHub workflow action
variables:
  APP_NAME: $APP_NAME
  APP_VERSION: $APP_VERSION
  BUILD_NUMBER: $BUILD_NUMBER

output: dist/

releases:
  # Production release (tag git)
  - name: production
    jobs:
      # Android APK builds
      - name: android-apk-universal
        package:
          platform: android
          target: apk
          build_args:
            build-name: $APP_VERSION
            dart-define:
              ENVIRONMENT: production

      - name: android-apk-split
        package:
          platform: android
          target: apk
          build_args:
            build-name: $APP_VERSION
            split-per-abi: true
            dart-define:
              ENVIRONMENT: production

      # Windows installer
      - name: windows-installer
        package:
          platform: windows
          target: exe
          build_args:
            build-name: $APP_VERSION
            build-number: $BUILD_NUMBER
            dart-define:
              ENVIRONMENT: production
        config:
          exe:
            installer_name: "$APP_NAME_Setup_v$APP_VERSION"
            include_redistributables: true
            install_dir_name: $APP_NAME
            create_start_menu_entry: true
            create_desktop_shortcut: true

        # Auto-publish to GitHub Releases
        publish_to: github
        publish_config:
          github:
            draft: false
            prerelease: false
            generate_release_notes: true

  # Development/Beta release
  - name: beta
    jobs:
      # Android APKs beta
      - name: android-apk-universal
        package:
          platform: android
          target: apk
          build_args:
            build-name: $APP_VERSION
            dart-define:
              ENVIRONMENT: beta

      - name: android-apk-split
        package:
          platform: android
          target: apk
          build_args:
            build-name: $APP_VERSION
            split-per-abi: true
            dart-define:
              ENVIRONMENT: beta

      # Windows installer beta
      - name: windows-installer
        package:
          platform: windows
          target: exe
          build_args:
            build-name: $APP_VERSION
            build-number: $BUILD_NUMBER
            dart-define:
              ENVIRONMENT: beta
        config:
          exe:
            installer_name: "$APP_NAME_Setup_v$APP_VERSION-beta"
            include_redistributables: true
            install_dir_name: $APP_NAME
            create_start_menu_entry: true
            create_desktop_shortcut: true
